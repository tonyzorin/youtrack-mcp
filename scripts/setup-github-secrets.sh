#!/bin/bash

echo "ğŸ” GitHub Secrets Setup for Multi-Registry Publishing"
echo "====================================================="

echo ""
echo "This workflow now publishes to multiple registries:"
echo "ğŸ³ Docker Hub + GitHub Container Registry"
echo "ğŸ“¦ npmjs.org + GitHub Packages npm"
echo ""

echo "ğŸ“‹ Required GitHub Secrets:"
echo "=========================="
echo ""

echo "1. DOCKER_USERNAME (Docker Hub)"
echo "   â”œâ”€â”€ Name: DOCKER_USERNAME"
echo "   â”œâ”€â”€ Value: tonyzorin"
echo "   â””â”€â”€ Purpose: Docker Hub authentication"
echo ""

echo "2. DOCKER_PASSWORD (Docker Hub)"
echo "   â”œâ”€â”€ Name: DOCKER_PASSWORD"
echo "   â”œâ”€â”€ Value: [Your Docker Hub access token]"
echo "   â”œâ”€â”€ Create at: https://hub.docker.com/settings/security"
echo "   â”œâ”€â”€ Permissions: Read, Write, Delete"
echo "   â””â”€â”€ Purpose: Docker Hub publishing"
echo ""

echo "3. NPM_TOKEN (npmjs.org)"
echo "   â”œâ”€â”€ Name: NPM_TOKEN"
echo "   â”œâ”€â”€ Value: [Your npm access token]"
echo "   â”œâ”€â”€ Create at: https://www.npmjs.com/settings/tokens"
echo "   â”œâ”€â”€ Type: Automation token (or Classic with Publish permissions)"
echo "   â””â”€â”€ Purpose: npm package publishing to npmjs.org"
echo ""

echo "4. GITHUB_TOKEN (Automatic)"
echo "   â”œâ”€â”€ Name: GITHUB_TOKEN"
echo "   â”œâ”€â”€ Value: [Automatically provided by GitHub Actions]"
echo "   â”œâ”€â”€ Purpose: GitHub Container Registry + GitHub Packages"
echo "   â””â”€â”€ Note: No manual setup required"
echo ""

echo "ğŸ”§ Step-by-Step Setup:"
echo "======================"
echo ""

echo "STEP 1: Create Docker Hub Access Token"
echo "--------------------------------------"
echo "1. Go to: https://hub.docker.com/settings/security"
echo "2. Click 'New Access Token'"
echo "3. Description: 'GitHub Actions youtrack-mcp'"
echo "4. Permissions: 'Read, Write, Delete'"
echo "5. Copy the token (starts with dckr_pat_...)"
echo ""

echo "STEP 2: Create npm Access Token"
echo "-------------------------------"
echo "1. Go to: https://www.npmjs.com/settings/tokens"
echo "2. Click 'Generate New Token'"
echo "3. Type: 'Automation' (recommended) or 'Classic'"
echo "4. If Classic: Select 'Publish' permission"
echo "5. Copy the token (starts with npm_...)"
echo ""

echo "STEP 3: Add Secrets to GitHub Repository"
echo "----------------------------------------"
echo "1. Go to: https://github.com/tonyzorin/youtrack-mcp/settings/secrets/actions"
echo "2. Click 'New repository secret' for each:"
echo ""
echo "   DOCKER_USERNAME:"
echo "   â”œâ”€â”€ Secret Name: DOCKER_USERNAME"
echo "   â””â”€â”€ Secret Value: tonyzorin"
echo ""
echo "   DOCKER_PASSWORD:"
echo "   â”œâ”€â”€ Secret Name: DOCKER_PASSWORD"
echo "   â””â”€â”€ Secret Value: [Docker Hub token from Step 1]"
echo ""
echo "   NPM_TOKEN:"
echo "   â”œâ”€â”€ Secret Name: NPM_TOKEN"
echo "   â””â”€â”€ Secret Value: [npm token from Step 2]"
echo ""

echo "âœ… Verification Checklist:"
echo "=========================="
echo ""
echo "After adding all secrets, verify in GitHub:"
echo "â”œâ”€â”€ DOCKER_USERNAME âœ“"
echo "â”œâ”€â”€ DOCKER_PASSWORD âœ“"
echo "â”œâ”€â”€ NPM_TOKEN âœ“"
echo "â””â”€â”€ GITHUB_TOKEN âœ“ (automatic)"
echo ""

echo "ğŸš€ What Happens After Setup:"
echo "==========================="
echo ""
echo "ğŸ“¦ On Every Main Branch Push:"
echo "â”œâ”€â”€ Build & test code"
echo "â”œâ”€â”€ Publish Docker images:"
echo "â”‚   â”œâ”€â”€ tonyzorin/youtrack-mcp:{version}_wip"
echo "â”‚   â””â”€â”€ ghcr.io/tonyzorin/youtrack-mcp:{version}_wip"
echo "â””â”€â”€ Skip npm publishing (only on releases)"
echo ""

echo "ğŸ‰ On Every GitHub Release:"
echo "â”œâ”€â”€ Build & test code"
echo "â”œâ”€â”€ Publish Docker images:"
echo "â”‚   â”œâ”€â”€ tonyzorin/youtrack-mcp:latest"
echo "â”‚   â”œâ”€â”€ tonyzorin/youtrack-mcp:{version}"
echo "â”‚   â”œâ”€â”€ ghcr.io/tonyzorin/youtrack-mcp:latest"
echo "â”‚   â””â”€â”€ ghcr.io/tonyzorin/youtrack-mcp:{version}"
echo "â”œâ”€â”€ Publish npm packages:"
echo "â”‚   â”œâ”€â”€ youtrack-mcp-tonyzorin@{version} (npmjs.org)"
echo "â”‚   â””â”€â”€ @tonyzorin/youtrack-mcp@{version} (GitHub Packages)"
echo "â””â”€â”€ Update package.json version automatically"
echo ""

echo "ğŸ” Testing Your Setup:"
echo "======================"
echo ""
echo "1. Verify secrets are added correctly in GitHub"
echo "2. Push a commit to main branch"
echo "3. Check GitHub Actions workflow run"
echo "4. Verify Docker images appear in both registries"
echo "5. Create a release to test npm publishing"
echo ""

echo "ğŸ“š Registry URLs:"
echo "================"
echo ""
echo "Docker Hub:"
echo "â””â”€â”€ https://hub.docker.com/r/tonyzorin/youtrack-mcp"
echo ""
echo "GitHub Container Registry:"
echo "â””â”€â”€ https://github.com/tonyzorin/youtrack-mcp/pkgs/container/youtrack-mcp"
echo ""
echo "npmjs.org:"
echo "â””â”€â”€ https://www.npmjs.com/package/youtrack-mcp-tonyzorin"
echo ""
echo "GitHub Packages npm:"
echo "â””â”€â”€ https://github.com/tonyzorin/youtrack-mcp/pkgs/npm/%40tonyzorin%2Fyoutrack-mcp"
echo ""

echo "ğŸ’¡ Pro Tips:"
echo "============"
echo ""
echo "âœ… Use automation tokens for npm (more secure)"
echo "âœ… Docker Hub tokens are preferable to passwords"
echo "âœ… GITHUB_TOKEN is automatically available, no setup needed"
echo "âœ… GitHub Container Registry uses GITHUB_TOKEN (free)"
echo "âœ… Both Docker registries will have identical content"
echo "âœ… Both npm registries will have identical functionality"
echo "âš ï¸  npm packages only publish on GitHub releases, not main pushes"
echo "âš ï¸  Keep your tokens secure and rotate them periodically"
echo ""

echo "ğŸ¯ Next Steps:"
echo "=============="
echo "1. Complete the token setup above"
echo "2. Verify all 3 secrets are added to GitHub"
echo "3. Push a commit to test Docker image publishing"
echo "4. Create a release to test npm package publishing"
echo "5. Update your documentation with new registry options" 